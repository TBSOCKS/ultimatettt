<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBH22 ‚Äî Ultimate Tic Tac Trivia</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f0f4f8; --surface: #dce8f5; --cell-bg: #e8f0f8; --border: #a0b8d0;
    --divider: #2a7de1; --text: #1a1a2e; --muted: #4a6080; --accent: #2a7de1;
    --header-bg: #b8d0e8; --p1: #e85d5d; --p2: #4caf50;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; min-height: 100vh; }

  /* ===== SETUP ===== */
  #setup-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 40px 20px; background: linear-gradient(135deg,#e8f0f8 0%,#d0e4f4 100%); }
  .setup-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(32px,5vw,64px); letter-spacing: 5px; color: var(--accent); text-align: center; line-height: 1; margin-bottom: 6px; }
  .setup-subtitle { font-size: 12px; letter-spacing: 4px; text-transform: uppercase; color: var(--muted); margin-bottom: 40px; }
  .setup-card { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 36px; width: 100%; max-width: 600px; display: flex; flex-direction: column; gap: 28px; box-shadow: 0 4px 24px rgba(42,125,225,0.1); }
  .players-row { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .player-setup { display: flex; flex-direction: column; gap: 10px; }
  .player-label { font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 3px; }
  .player-label.p1 { color: var(--p1); }
  .player-label.p2 { color: var(--p2); }
  .setup-input { background: #f4f8fc; border: 1px solid var(--border); border-radius: 8px; padding: 11px 13px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; transition: border-color 0.2s; width: 100%; }
  .setup-input:focus { outline: none; border-color: var(--accent); }
  .color-row { display: flex; align-items: center; gap: 10px; }
  .color-preview { width: 30px; height: 30px; border-radius: 6px; border: 1px solid var(--border); flex-shrink: 0; }
  .starter-section { display: flex; flex-direction: column; gap: 10px; }
  .starter-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); }
  .starter-toggle { display: flex; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
  .starter-btn { flex: 1; padding: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 14px; letter-spacing: 2px; border: none; background: #f4f8fc; color: var(--muted); cursor: pointer; transition: all 0.15s; }
  .starter-btn.active-p1 { background: var(--p1); color: #fff; }
  .starter-btn.active-p2 { background: var(--p2); color: #fff; }
  .start-btn { background: var(--accent); color: #fff; border: none; border-radius: 10px; padding: 15px 32px; font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 3px; cursor: pointer; transition: background 0.2s; }
  .start-btn:hover { background: #1a6dd1; }

  /* ===== GAME SCREEN ===== */
  #game-screen { display: none; flex-direction: column; height: 100vh; padding: 6px; gap: 6px; overflow: hidden; }
  .game-header { display: flex; align-items: center; justify-content: space-between; background: #fff; border: 1px solid var(--border); border-radius: 10px; padding: 5px 12px; flex-shrink: 0; gap: 6px; flex-wrap: wrap; position: relative; }
  .player-badge { display: flex; align-items: center; gap: 8px; padding: 6px 14px; border-radius: 6px; border: 2px solid transparent; transition: all 0.25s; }
  .player-badge.active { border-color: var(--player-color,var(--accent)); background: color-mix(in srgb,var(--player-color,var(--accent)) 12%,transparent); }
  .badge-dot { width: 11px; height: 11px; border-radius: 50%; flex-shrink: 0; }
  .badge-name { font-family: 'Bebas Neue', sans-serif; font-size: 15px; letter-spacing: 2px; color: var(--text); }
  .badge-score { font-size: 12px; color: var(--muted); font-weight: 600; }
  .turn-indicator { font-family: 'Bebas Neue', sans-serif; font-size: 12px; letter-spacing: 3px; text-transform: uppercase; color: var(--muted); text-align: center; }
  .turn-name { font-size: 16px; display: block; }
  .timer-display { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 2px; color: var(--accent); line-height: 1; transition: color 0.3s; }
  .timer-display.warning { color: #e85d5d; }
  .timer-controls { display: flex; gap: 5px; }
  .timer-btn { background: transparent; border: 1px solid var(--border); color: var(--muted); border-radius: 5px; padding: 3px 9px; font-family: 'Bebas Neue', sans-serif; font-size: 11px; letter-spacing: 1px; cursor: pointer; transition: all 0.15s; }
  .timer-btn:hover { border-color: var(--accent); color: var(--accent); }
  .timer-btn.running { border-color: #e85d5d; color: #e85d5d; }

  /* ===== MEGA GRID ===== */
  .grid-wrapper { overflow: auto; flex: 1; border: 3px solid var(--divider); border-radius: 4px; background: var(--divider); }
  .mega-grid { display: grid; grid-template-columns: 90px repeat(3,1fr) 3px repeat(3,1fr) 3px repeat(3,1fr); grid-template-rows: auto repeat(3,1fr) 3px repeat(3,1fr) 3px repeat(3,1fr); width: 100%; height: 100%; min-width: 0; gap: 0; }
  .corner-cell { background: var(--header-bg); border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 21; }
  .macro-divider-col { background: var(--divider); grid-row: 1/-1; }
  .macro-divider-row { background: var(--divider); grid-column: 1/-1; }
  .col-header { background: var(--header-bg); border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 4px 3px; font-size: 9px; font-weight: 800; text-align: center; color: #0f1e3a; line-height: 1.25; display: flex; align-items: center; justify-content: center; text-transform: uppercase; letter-spacing: 0.5px; position: sticky; top: 0; z-index: 20; }
  .row-header { background: var(--header-bg); border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 4px 5px; font-size: 9px; font-weight: 800; color: #0f1e3a; line-height: 1.25; display: flex; align-items: center; text-transform: uppercase; letter-spacing: 0.5px; justify-content: center; text-align: center; }
  .grid-cell { background: var(--cell-bg); border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); cursor: pointer; position: relative; overflow: hidden; transition: background 0.1s; }
  .grid-cell:hover:not(.claimed):not(.locked) { background: #ccdff5; z-index: 5; }
  .grid-cell.selectable { animation: pulse 1.6s ease-in-out infinite; }
  @keyframes pulse { 0%,100% { box-shadow: inset 0 0 0 2px rgba(42,125,225,0.35); } 50% { box-shadow: inset 0 0 0 3px rgba(42,125,225,0.8); } }
  .grid-cell.locked { cursor: not-allowed; opacity: 0.38; }
  .grid-cell.claimed { cursor: default; }
  .cell-photo { width: 100%; height: 100%; object-fit: cover; position: absolute; inset: 0; }
  .cell-gradient { position: absolute; inset: 0; background: linear-gradient(to top,rgba(0,0,0,0.6) 0%,transparent 55%); pointer-events: none; }
  .cell-name { position: absolute; bottom: 3px; left: 0; right: 0; text-align: center; font-size: 8px; font-weight: 700; color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.9); pointer-events: none; }
  .cell-name-dark { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; color: var(--text); pointer-events: none; text-align: center; padding: 2px; }
  .cell-border-overlay { position: absolute; inset: 0; border: 4px solid var(--claim-color,transparent); pointer-events: none; z-index: 2; }

  /* ===== MODAL ===== */
  #modal-overlay { display: none; position: fixed; inset: 0; background: rgba(10,20,40,0.55); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(4px); padding-top: 80px; align-items: flex-start; }
  #modal-overlay.open { display: flex; }
  .modal { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 24px; width: 92%; max-width: 460px; display: flex; flex-direction: column; gap: 15px; animation: modal-in 0.2s ease; max-height: 90vh; overflow-y: auto; box-shadow: 0 8px 40px rgba(42,125,225,0.18); }
  @keyframes modal-in { from { transform: translateY(12px) scale(0.97); opacity: 0; } to { transform: none; opacity: 1; } }
  .modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 13px; letter-spacing: 3px; color: var(--muted); text-transform: uppercase; }
  .modal-cats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .modal-cat { background: #eaf2ff; border: 1px solid #c0d8f0; border-radius: 8px; padding: 9px 11px; font-size: 10px; font-weight: 700; color: var(--text); line-height: 1.4; }
  .modal-cat span { display: block; font-size: 8px; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); margin-bottom: 2px; }
  .modal-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 5px; }
  .answer-select { width: 100%; background: #f4f8fc; border: 1px solid var(--border); border-radius: 8px; padding: 11px 13px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%234a6080' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 13px center; padding-right: 34px; }
  .answer-select:focus { outline: none; border-color: var(--accent); }
  .answer-select option { background: #fff; color: var(--text); }
  .cast-roster { display: flex; flex-wrap: wrap; gap: 5px; }
  .cast-tag { padding: 4px 9px; border-radius: 20px; font-size: 10px; font-weight: 600; background: #eaf2ff; border: 1px solid #c0d8f0; color: var(--text); white-space: nowrap; }
  .cast-tag.strikeout { text-decoration: line-through; opacity: 0.38; color: var(--muted); }
  .modal-btns { display: flex; flex-direction: column; gap: 8px; }
  .btn-submit { background: var(--accent); color: #fff; border: none; border-radius: 8px; padding: 13px; font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 2px; cursor: pointer; transition: background 0.15s; }
  .btn-submit:hover { background: #1a6dd1; }
  .btn-cancel { background: transparent; color: var(--muted); border: 1px solid var(--border); border-radius: 8px; padding: 9px; font-family: 'DM Sans', sans-serif; font-size: 13px; cursor: pointer; }
  .btn-cancel:hover { border-color: var(--accent); color: var(--accent); }
  .modal-correct { text-align: center; font-family: 'Bebas Neue', sans-serif; font-size: 56px; letter-spacing: 4px; padding: 24px 0; animation: correct-pop 0.35s ease; }
  @keyframes correct-pop { 0% { transform: scale(0.6); opacity: 0; } 70% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }

  /* ===== WIN ===== */
  #win-screen { display: none; position: fixed; inset: 0; background: rgba(240,244,248,0.96); z-index: 200; align-items: center; justify-content: center; flex-direction: column; gap: 16px; text-align: center; }
  #win-screen.open { display: flex; }
  .win-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(60px,12vw,120px); letter-spacing: 8px; line-height: 1; }
  .win-sub { font-size: 14px; color: var(--muted); letter-spacing: 3px; text-transform: uppercase; }
  .win-restart { background: var(--accent); color: #fff; border: none; border-radius: 10px; padding: 14px 36px; font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 3px; cursor: pointer; margin-top: 12px; }
  .win-restart:hover { background: #1a6dd1; }
</style>
</head>
<body>

<!-- ========== SETUP ========== -->
<div id="setup-screen">
  <div class="setup-title">Ultimate Tic Tac Trivia</div>
  <div class="setup-subtitle">BBH22 ¬∑ Season Trivia</div>
  <div class="setup-card">
    <div class="players-row">
      <div class="player-setup">
        <div class="player-label p1">Player 1</div>
        <input class="setup-input" id="p1-name" type="text" placeholder="Enter name..." value="Player 1">
        <div class="color-row">
          <div class="color-preview" id="p1-preview" style="background:#e85d5d"></div>
          <input type="color" id="p1-color-picker" value="#e85d5d" style="width:30px;height:30px;border:1px solid var(--border);border-radius:6px;padding:2px;cursor:pointer;background:none;flex-shrink:0;">
          <input class="setup-input" id="p1-color" type="text" placeholder="#e85d5d" value="#e85d5d">
        </div>
      </div>
      <div class="player-setup">
        <div class="player-label p2">Player 2</div>
        <input class="setup-input" id="p2-name" type="text" placeholder="Enter name..." value="Player 2">
        <div class="color-row">
          <div class="color-preview" id="p2-preview" style="background:#4caf50"></div>
          <input type="color" id="p2-color-picker" value="#4caf50" style="width:30px;height:30px;border:1px solid var(--border);border-radius:6px;padding:2px;cursor:pointer;background:none;flex-shrink:0;">
          <input class="setup-input" id="p2-color" type="text" placeholder="#4caf50" value="#4caf50">
        </div>
      </div>
    </div>
    <div class="starter-section">
      <div class="starter-label">Starting Player</div>
      <div class="starter-toggle">
        <button class="starter-btn active-p1" id="starter-p1" onclick="setStarter(0)">Player 1 Goes First</button>
        <button class="starter-btn" id="starter-p2" onclick="setStarter(1)">Player 2 Goes First</button>
      </div>
    </div>
    <button class="start-btn" onclick="startGame()">START COMPETITION</button>
    <a href="/example.html" style="text-align:center;color:var(--muted);font-family:'DM Sans',sans-serif;font-size:13px;text-decoration:none;letter-spacing:1px;">Go to Example ‚Üí</a>
  </div>
</div>

<!-- ========== GAME ========== -->
<div id="game-screen">
  <div class="game-header">
    <div class="player-badge" id="badge-p1">
      <div class="badge-dot" id="dot-p1" style="background:#e85d5d"></div>
      <div class="badge-name" id="name-p1">Player 1</div>
      <div id="last-p1" style="font-size:10px;color:var(--muted);letter-spacing:0.5px;min-height:14px;"></div>
      <div class="badge-score">üèÜ <span id="score-p1">0</span> / 3</div>
    </div>
    <div style="text-align:center;display:flex;flex-direction:column;align-items:center;gap:6px;position:relative;z-index:101;background:rgba(255,255,255,0.85);border-radius:10px;padding:6px 14px;backdrop-filter:blur(4px);">
      <div class="turn-indicator">Current Turn<span class="turn-name" id="turn-display" style="color:var(--accent)">‚Äî</span></div>
      <div class="timer-display" id="timer-display">1:00</div>
      <div class="timer-controls">
        <button class="timer-btn" id="timer-toggle-btn" onclick="toggleTimer()">‚ñ∂ START</button>
        <button class="timer-btn" onclick="resetTimer()">‚Ü∫ RESET</button>
      </div>
    </div>
    <div style="position:absolute;top:6px;right:6px;">
      <button onclick="if(confirm('Reset the game?'))location.reload()" style="background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:5px;padding:3px 9px;font-family:'Bebas Neue',sans-serif;font-size:11px;letter-spacing:1px;cursor:pointer;">‚Ü∫ RESET</button>
    </div>
    <div class="player-badge" id="badge-p2">
      <div class="badge-dot" id="dot-p2" style="background:#4caf50"></div>
      <div class="badge-name" id="name-p2">Player 2</div>
      <div id="last-p2" style="font-size:10px;color:var(--muted);letter-spacing:0.5px;min-height:14px;"></div>
      <div class="badge-score">üèÜ <span id="score-p2">0</span> / 3</div>
    </div>
  </div>
  <div class="grid-wrapper">
    <div class="mega-grid" id="mega-grid"></div>
  </div>
</div>

<!-- ========== MODAL ========== -->
<div id="modal-overlay">
  <div class="modal">
    <div id="modal-inner"></div>
  </div>
</div>

<!-- ========== TIMES UP ========== -->
<div id="timesup-overlay" style="display:none;position:fixed;inset:0;z-index:500;background:rgba(10,20,40,0.7);align-items:center;justify-content:center;backdrop-filter:blur(3px);">
  <div style="font-family:'Bebas Neue',sans-serif;font-size:72px;letter-spacing:8px;color:#fff;text-shadow:0 8px 32px rgba(0,0,0,0.5);animation:correct-pop 0.35s ease;">TIME'S UP!</div>
</div>

<!-- ========== WIN ========== -->
<div id="win-screen">
  <div class="win-title" id="win-name">PLAYER 1</div>
  <div class="win-sub">Wins Ultimate Tic Tac Trivia!</div>
  <button class="win-restart" onclick="location.reload()">PLAY AGAIN</button>
</div>

<script>
const ALL_CAST=["BENJI","BRANDON","CASEY","CHRIS","DREW","ERIN","GENKI","JACOB","JOHNNY","JULIA","RAYA","ROY","SHANNON","SIMONA","STEPH"];
const CAST_PHOTOS={"BENJI":"","BRANDON":"","CASEY":"","CHRIS":"","DREW":"","ERIN":"","GENKI":"","JACOB":"","JOHNNY":"","JULIA":"","RAYA":"","ROY":"","SHANNON":"","SIMONA":"","STEPH":""};
const COL_CATS=["INITIAL NOM AT LEAST ONCE","DID NOT WIN A POV","RECEIVED AT LEAST 1 VOTE TO EVICT","COMPETED IN 6+ PREJURY COMPS","NEVER WON CHALLENGES IN B2B ROUNDS","NEVER A NOMINEE DURING A LIVE EVENT","IN THE SAME HOUSE 3 CONSECUTIVE ROUNDS","NOMINATED THE ROUND AFTER WINNING HOH","CAST AN EVICTION VOTE 3 CONSECUTIVE ROUNDS"];
const ROW_CATS=["WON AT LEAST ONE CHALLENGE","TOP 3 3+ TIMES IN CHALLENGES","IN BOTH HOUSES 2+ TIMES","COMPETED IN AT LEAST 1 LIVE EVENT POV","SCORED ABOVE 0 IN TRAIN OF THOUGHT","NEVER A FINAL NOMINEE IN THE PREJURY","PLACED LAST IN AT LEAST 1 CHALLENGE","SECOND PLACE IN AT LEAST 1 CHALLENGE","RECEIVED AN EVEN NUMBER OF VOTES TO EVICT"];
const VALID_ANSWERS=[
[["BENJI","BRANDON","CHRIS","DREW","GENKI","JACOB","JOHNNY","RAYA","ROY","SIMONA","STEPH"],["BRANDON","CHRIS","JOHNNY","JULIA","RAYA","ROY","STEPH"],["BENJI","BRANDON","CHRIS","GENKI","JACOB","JOHNNY","JULIA","RAYA","ROY","STEPH"],["BENJI","CHRIS","DREW","GENKI","JACOB","JOHNNY","JULIA","RAYA","ROY","STEPH"],["BRANDON","CHRIS","JACOB","JOHNNY","JULIA","RAYA","ROY","STEPH"],["BENJI","BRANDON","CHRIS","JACOB","JULIA"],["BENJI","BRANDON","CHRIS","JACOB","JOHNNY","RAYA","ROY","SIMONA","STEPH"],["BENJI","CHRIS","DREW","GENKI","RAYA","ROY","STEPH"],["BENJI","BRANDON","DREW","GENKI","JACOB","JOHNNY","RAYA","SIMONA","STEPH"]],
[["BENJI","BRANDON","DREW","ERIN","GENKI","JACOB","JOHNNY","RAYA","SIMONA"],["BRANDON","ERIN","JOHNNY","JULIA","RAYA"],["BENJI","BRANDON","ERIN","GENKI","JACOB","JOHNNY","JULIA","RAYA"],["BENJI","DREW","GENKI","JACOB","JOHNNY","JULIA","RAYA"],["BRANDON","ERIN","JACOB","JOHNNY","JULIA","RAYA"],["BENJI","BRANDON","ERIN","JACOB","JULIA"],["BENJI","BRANDON","JACOB","JOHNNY","RAYA","SIMONA"],["BENJI","DREW","GENKI","RAYA"],["BENJI","BRANDON","DREW","GENKI","JACOB","JOHNNY","RAYA","SIMONA"]],
[["BENJI","BRANDON","CHRIS","DREW","GENKI","JACOB","JOHNNY","SIMONA","STEPH"],["BRANDON","CHRIS","JOHNNY","JULIA","SHANNON","STEPH"],["BENJI","BRANDON","CHRIS","GENKI","JACOB","JOHNNY","JULIA","SHANNON","STEPH"],["BENJI","CHRIS","DREW","GENKI","JACOB","JOHNNY","JULIA","STEPH"],["BRANDON","CHRIS","JACOB","JOHNNY","JULIA","SHANNON","STEPH"],["BENJI","BRANDON","CHRIS","JACOB","JULIA","SHANNON"],["BENJI","BRANDON","CHRIS","JACOB","JOHNNY","SIMONA","STEPH"],["BENJI","CHRIS","DREW","GENKI","STEPH"],["BENJI","BRANDON","DREW","GENKI","JACOB","JOHNNY","SIMONA","STEPH"]],
[["BENJI","BRANDON","DREW","GENKI","JACOB","JOHNNY","RAYA","ROY","SIMONA","STEPH"],["BRANDON","JOHNNY","RAYA","ROY","STEPH"],["BENJI","BRANDON","GENKI","JACOB","JOHNNY","RAYA","ROY","STEPH"],["BENJI","DREW","GENKI","JACOB","JOHNNY","RAYA","ROY","STEPH"],["BRANDON","JACOB","JOHNNY","RAYA","ROY","STEPH"],["BENJI","BRANDON","JACOB"],["BENJI","BRANDON","JACOB","JOHNNY","RAYA","ROY","SIMONA","STEPH"],["BENJI","DREW","GENKI","RAYA","ROY","STEPH"],["BENJI","BRANDON","DREW","GENKI","JACOB","JOHNNY","RAYA","SIMONA","STEPH"]],
[["BENJI","BRANDON","CASEY","DREW","ERIN","GENKI","JACOB","JOHNNY","ROY","SIMONA"],["BRANDON","CASEY","ERIN","JOHNNY","JULIA","ROY","SHANNON"],["BENJI","BRANDON","ERIN","GENKI","JACOB","JOHNNY","JULIA","ROY","SHANNON"],["BENJI","DREW","GENKI","JACOB","JOHNNY","JULIA","ROY"],["BRANDON","CASEY","ERIN","JACOB","JOHNNY","JULIA","ROY","SHANNON"],["BENJI","BRANDON","CASEY","ERIN","JACOB","JULIA","SHANNON"],["BENJI","BRANDON","JACOB","JOHNNY","ROY","SIMONA"],["BENJI","DREW","GENKI","ROY"],["BENJI","BRANDON","CASEY","DREW","GENKI","JACOB","JOHNNY","SIMONA"]],
[["BENJI","BRANDON","CASEY","DREW","JACOB","JOHNNY","RAYA","SIMONA"],["BRANDON","CASEY","JOHNNY","JULIA","RAYA"],["BENJI","BRANDON","JACOB","JOHNNY","JULIA","RAYA"],["BENJI","DREW","JACOB","JOHNNY","JULIA","RAYA"],["BRANDON","CASEY","JACOB","JOHNNY","JULIA","RAYA"],["BENJI","BRANDON","CASEY","JACOB","JULIA"],["BENJI","BRANDON","JACOB","JOHNNY","RAYA","SIMONA"],["BENJI","DREW","RAYA"],["BENJI","BRANDON","CASEY","DREW","JACOB","JOHNNY","RAYA","SIMONA"]],
[["BENJI","BRANDON","CASEY","CHRIS","GENKI","JACOB","JOHNNY","RAYA","STEPH"],["BRANDON","CASEY","CHRIS","JOHNNY","RAYA","STEPH"],["BENJI","BRANDON","CHRIS","GENKI","JACOB","JOHNNY","RAYA","STEPH"],["BENJI","CHRIS","GENKI","JACOB","JOHNNY","RAYA","STEPH"],["BRANDON","CASEY","CHRIS","JACOB","JOHNNY","RAYA","STEPH"],["BENJI","BRANDON","CASEY","CHRIS","JACOB"],["BENJI","BRANDON","CHRIS","JACOB","JOHNNY","RAYA","STEPH"],["BENJI","CHRIS","GENKI","RAYA","STEPH"],["BENJI","BRANDON","CASEY","GENKI","JACOB","JOHNNY","RAYA","STEPH"]],
[["BENJI","BRANDON","DREW","ERIN","GENKI","JOHNNY","RAYA","SIMONA"],["BRANDON","ERIN","JOHNNY","JULIA","RAYA"],["BENJI","BRANDON","ERIN","GENKI","JOHNNY","JULIA","RAYA"],["BENJI","DREW","GENKI","JOHNNY","JULIA","RAYA"],["BRANDON","ERIN","JOHNNY","JULIA","RAYA"],["BENJI","BRANDON","ERIN","JULIA"],["BENJI","BRANDON","JOHNNY","RAYA","SIMONA"],["BENJI","DREW","GENKI","RAYA"],["BENJI","BRANDON","DREW","GENKI","JOHNNY","RAYA","SIMONA"]],
[["BRANDON","CASEY","DREW","GENKI","JACOB","JOHNNY","ROY","SIMONA","STEPH"],["BRANDON","CASEY","JOHNNY","JULIA","ROY","STEPH"],["BRANDON","GENKI","JACOB","JOHNNY","JULIA","ROY","STEPH"],["DREW","GENKI","JACOB","JOHNNY","JULIA","ROY","STEPH"],["BRANDON","CASEY","JACOB","JOHNNY","JULIA","ROY","STEPH"],["BRANDON","CASEY","JACOB","JULIA"],["BRANDON","JACOB","JOHNNY","ROY","SIMONA","STEPH"],["DREW","GENKI","ROY","STEPH"],["BRANDON","CASEY","DREW","GENKI","JACOB","JOHNNY","SIMONA","STEPH"]]
];

let players=[{name:"Player 1",color:"#e85d5d"},{name:"Player 2",color:"#4caf50"}];
let board,miniWon,currentPlayer,scores,forcedMacro,activeCell,wrongGuesses,lastGuessed;
let starterPlayer=0;
let timerSeconds=60,timerInterval=null,timerRunning=false;

function handleTimesUp(){
  const o=document.getElementById('timesup-overlay');
  o.style.display='flex';
  setTimeout(()=>{
    o.style.display='none';
    if(document.getElementById('modal-overlay').classList.contains('open'))closeModal();
    forcedMacro=null;lastGuessed[currentPlayer]=null;
    currentPlayer=1-currentPlayer;
    updateUI();resetTimer();toggleTimer();
  },1200);
}

function setStarter(p){
  starterPlayer=p;
  document.getElementById('starter-p1').className='starter-btn'+(p===0?' active-p1':'');
  document.getElementById('starter-p2').className='starter-btn'+(p===1?' active-p2':'');
}

function toggleTimer(){
  if(timerRunning){
    clearInterval(timerInterval);timerInterval=null;timerRunning=false;
    document.getElementById('timer-toggle-btn').textContent='‚ñ∂ START';
    document.getElementById('timer-toggle-btn').classList.remove('running');
  } else {
    timerRunning=true;
    document.getElementById('timer-toggle-btn').textContent='‚è∏ STOP';
    document.getElementById('timer-toggle-btn').classList.add('running');
    timerInterval=setInterval(()=>{
      timerSeconds--;
      updateTimerDisplay();
      if(timerSeconds<=0){
        clearInterval(timerInterval);timerInterval=null;timerRunning=false;
        document.getElementById('timer-toggle-btn').textContent='‚ñ∂ START';
        document.getElementById('timer-toggle-btn').classList.remove('running');
        handleTimesUp();
      }
    },1000);
  }
}

function resetTimer(){
  clearInterval(timerInterval);timerInterval=null;timerRunning=false;
  timerSeconds=60;updateTimerDisplay();
  document.getElementById('timer-toggle-btn').textContent='‚ñ∂ START';
  document.getElementById('timer-toggle-btn').classList.remove('running');
}

function updateTimerDisplay(){
  const d=document.getElementById('timer-display');
  if(!d)return;
  const m=Math.floor(timerSeconds/60),s=timerSeconds%60;
  d.textContent=`${m}:${s.toString().padStart(2,'0')}`;
  d.classList.toggle('warning',timerSeconds<=10);
}

function initState(){
  board=Array.from({length:9},()=>Array(9).fill(null));
  miniWon=Array.from({length:3},()=>Array(3).fill(null));
  currentPlayer=starterPlayer;scores=[0,0];forcedMacro=null;activeCell=null;
  wrongGuesses=Array.from({length:9},()=>Array.from({length:9},()=>new Set()));
  lastGuessed=[null,null];resetTimer();
}

function syncColor(picker,text,preview){
  const val=picker?picker.value:text.value;
  if(preview)preview.style.background=val;
  if(picker&&text)text.value=val;
  if(picker)picker.value=val;
  updateStarterLabels();
}
function getLabelColor(hex){
  const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  const luminance=(0.299*r+0.587*g+0.114*b)/255;
  return luminance>0.55?'#1a1a2e':'#ffffff';
}
function updateStarterLabels(){
  const n1=document.getElementById('p1-name').value||'Player 1';
  const n2=document.getElementById('p2-name').value||'Player 2';
  const c1=document.getElementById('p1-color').value||'#e85d5d';
  const c2=document.getElementById('p2-color').value||'#4caf50';
  const b1=document.getElementById('starter-p1');
  const b2=document.getElementById('starter-p2');
  b1.textContent=n1+' Goes First';
  b2.textContent=n2+' Goes First';
  document.documentElement.style.setProperty('--p1',c1);
  document.documentElement.style.setProperty('--p2',c2);
  document.getElementById('starter-p1').style.color=getLabelColor(c1);
  document.getElementById('starter-p2').style.color=getLabelColor(c2);
}
const p1pick=document.getElementById('p1-color-picker');
const p1text=document.getElementById('p1-color');
const p1prev=document.getElementById('p1-preview');
const p2pick=document.getElementById('p2-color-picker');
const p2text=document.getElementById('p2-color');
const p2prev=document.getElementById('p2-preview');
p1pick.addEventListener('input',()=>syncColor(p1pick,p1text,p1prev));
p1text.addEventListener('input',()=>syncColor(null,p1text,p1prev));
p2pick.addEventListener('input',()=>syncColor(p2pick,p2text,p2prev));
p2text.addEventListener('input',()=>syncColor(null,p2text,p2prev));
document.getElementById('p1-name').addEventListener('input',updateStarterLabels);
document.getElementById('p2-name').addEventListener('input',updateStarterLabels);

function startGame(){
  players[0].name=document.getElementById('p1-name').value||'Player 1';
  players[0].color=document.getElementById('p1-color').value||'#e85d5d';
  players[1].name=document.getElementById('p2-name').value||'Player 2';
  players[1].color=document.getElementById('p2-color').value||'#4caf50';
  document.getElementById('name-p1').textContent=players[0].name;
  document.getElementById('name-p2').textContent=players[1].name;
  document.getElementById('dot-p1').style.background=players[0].color;
  document.getElementById('dot-p2').style.background=players[1].color;
  document.getElementById('badge-p1').style.setProperty('--player-color',players[0].color);
  document.getElementById('badge-p2').style.setProperty('--player-color',players[1].color);
  document.getElementById('setup-screen').style.display='none';
  document.getElementById('game-screen').style.display='flex';
  initState();buildGrid();updateUI();
}

function gcol(c){return 2+c+Math.floor(c/3);}
function grow(r){return 2+r+Math.floor(r/3);}

function buildGrid(){
  const g=document.getElementById('mega-grid');g.innerHTML='';
  const co=document.createElement('div');co.className='corner-cell';co.style.cssText='grid-column:1;grid-row:1;';g.appendChild(co);
  [5,9].forEach(gc=>{const d=document.createElement('div');d.className='macro-divider-col';d.style.cssText=`grid-column:${gc};grid-row:1/-1;`;g.appendChild(d);});
  [5,9].forEach(gr=>{const d=document.createElement('div');d.className='macro-divider-row';d.style.cssText=`grid-row:${gr};grid-column:1/-1;`;g.appendChild(d);});
  for(let c=0;c<9;c++){const h=document.createElement('div');h.className='col-header';h.style.cssText=`grid-column:${gcol(c)};grid-row:1;`;h.textContent=COL_CATS[c];g.appendChild(h);}
  for(let r=0;r<9;r++){
    const gr2=grow(r);
    const rh=document.createElement('div');rh.className='row-header';rh.style.cssText=`grid-column:1;grid-row:${gr2};`;rh.textContent=ROW_CATS[r];g.appendChild(rh);
    for(let c=0;c<9;c++){const cell=document.createElement('div');cell.className='grid-cell';cell.id=`cell-${r}-${c}`;cell.style.cssText=`grid-column:${gcol(c)};grid-row:${gr2};`;cell.addEventListener('click',()=>onCellClick(r,c));g.appendChild(cell);}
  }
}

function updateUI(){
  const td=document.getElementById('turn-display');td.textContent=players[currentPlayer].name;td.style.color=players[currentPlayer].color;
  document.getElementById('badge-p1').classList.toggle('active',currentPlayer===0);
  document.getElementById('badge-p2').classList.toggle('active',currentPlayer===1);
  document.getElementById('score-p1').textContent=scores[0];
  document.getElementById('score-p2').textContent=scores[1];
  document.getElementById('last-p1').textContent=lastGuessed[0]?`Last: ${lastGuessed[0]}`:'';
  document.getElementById('last-p2').textContent=lastGuessed[1]?`Last: ${lastGuessed[1]}`:'';
  for(let r=0;r<9;r++)for(let c=0;c<9;c++){
    const cell=document.getElementById(`cell-${r}-${c}`);cell.classList.remove('selectable','locked');
    const mr=Math.floor(r/3),mc=Math.floor(c/3);
    if(!board[r][c]){
      if(miniWon[mr][mc]!==null)cell.classList.add('locked');
      else if(forcedMacro===null)cell.classList.add('selectable');
      else if(mr===forcedMacro.mr&&mc===forcedMacro.mc)cell.classList.add('selectable');
      else cell.classList.add('locked');
    }
  }
}

function onCellClick(r,c){
  if(!document.getElementById(`cell-${r}-${c}`).classList.contains('selectable'))return;
  activeCell={r,c};
  document.getElementById('modal-inner').innerHTML=`
    <div class="modal-title">Make Your Guess</div>
    <div class="modal-cats"><div class="modal-cat"><span>Column</span>${COL_CATS[c]}</div><div class="modal-cat"><span>Row</span>${ROW_CATS[r]}</div></div>
    <div><div class="modal-label">Cast Members</div><div class="cast-roster" id="cast-roster"></div></div>
    <div><div class="modal-label">Select a Cast Member</div><select class="answer-select" id="answer-select"><option value="">‚Äî choose ‚Äî</option></select></div>
    <div class="modal-btns"><button class="btn-submit" onclick="submitAnswer()">SUBMIT ANSWER</button><button class="btn-cancel" onclick="closeModal()">Cancel</button></div>
  `;
  refreshCastList(r,c);
  document.getElementById('modal-overlay').classList.add('open');
}

function refreshCastList(r,c){
  const mr=Math.floor(r/3),mc=Math.floor(c/3),used={};
  for(let i=0;i<3;i++)for(let j=0;j<3;j++){const d=board[mr*3+i][mc*3+j];if(d)used[d.name]=(used[d.name]||0)+1;}
  const roster=document.getElementById('cast-roster'),sel=document.getElementById('answer-select');
  if(!roster||!sel)return;
  roster.innerHTML='';sel.innerHTML='<option value="">‚Äî choose ‚Äî</option>';
  ALL_CAST.forEach(n=>{
    const struck=wrongGuesses[r][c].has(n)||(used[n]||0)>=2||n===lastGuessed[currentPlayer];
    const t=document.createElement('div');t.className='cast-tag'+(struck?' strikeout':'');t.textContent=n;roster.appendChild(t);
    if(!struck){const o=document.createElement('option');o.value=n;o.textContent=n;sel.appendChild(o);}
  });
}

function submitAnswer(){
  if(!activeCell)return;
  const{r,c}=activeCell,sel=document.getElementById('answer-select'),name=sel?sel.value:'';
  if(!name)return;
  document.getElementById('modal-inner').innerHTML=`
    <div class="modal-title">Confirm Your Answer</div>
    <div class="modal-cats">
      <div class="modal-cat"><span>Column</span>${COL_CATS[c]}</div>
      <div class="modal-cat"><span>Row</span>${ROW_CATS[r]}</div>
    </div>
    <div style="text-align:center;padding:8px 0;font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;color:${players[currentPlayer].color}">${name}</div>
    <div class="modal-btns">
      <button class="btn-submit" onclick="confirmAnswer('${name}')">CONFIRM</button>
      <button class="btn-cancel" onclick="reopenGuess(${r},${c})">‚Üê CHANGE ANSWER</button>
    </div>
  `;
}

function confirmAnswer(name){
  if(!activeCell)return;
  const{r,c}=activeCell;
  if(VALID_ANSWERS[r][c].includes(name)){
    document.getElementById('modal-inner').innerHTML=`<div class="modal-correct" style="color:${players[currentPlayer].color}">CORRECT!</div>`;
    setTimeout(()=>commitCorrect(r,c,name),900);
  } else {
    wrongGuesses[r][c].add(name);
    document.getElementById('modal-inner').innerHTML=`<div class="modal-correct" style="color:#e85d5d">INCORRECT!</div>`;
    setTimeout(()=>{
      forcedMacro=null;lastGuessed[currentPlayer]=null;currentPlayer=1-currentPlayer;closeModal();updateUI();resetTimer();toggleTimer();
    },900);
  }
}

function reopenGuess(r,c){
  document.getElementById('modal-inner').innerHTML=`
    <div class="modal-title">Make Your Guess</div>
    <div class="modal-cats"><div class="modal-cat"><span>Column</span>${COL_CATS[c]}</div><div class="modal-cat"><span>Row</span>${ROW_CATS[r]}</div></div>
    <div><div class="modal-label">Cast Members</div><div class="cast-roster" id="cast-roster"></div></div>
    <div><div class="modal-label">Select a Cast Member</div><select class="answer-select" id="answer-select"><option value="">‚Äî choose ‚Äî</option></select></div>
    <div class="modal-btns"><button class="btn-submit" onclick="submitAnswer()">SUBMIT ANSWER</button><button class="btn-cancel" onclick="closeModal()">Cancel</button></div>
  `;
  refreshCastList(r,c);
}

function commitCorrect(r,c,name){
  board[r][c]={player:currentPlayer,name,photo:CAST_PHOTOS[name]||''};renderCell(r,c);
  const mr=Math.floor(r/3),mc=Math.floor(c/3),res=checkMiniTTT(mr,mc);
  let won=false;
  if(res!==null&&miniWon[mr][mc]===null){miniWon[mr][mc]=res;scores[res]++;renderMiniWon(mr,mc,res);won=true;if(scores[0]>=3||scores[1]>=3){closeModal();showWinScreen(res);return;}}
  const nm=r%3,nc=c%3;
  if(won){forcedMacro=(miniWon[nm][nc]===null&&!isMiniGridFull(nm,nc))?{mr:nm,mc:nc}:null;}
  else{forcedMacro=(miniWon[nm][nc]!==null||isMiniGridFull(nm,nc))?null:{mr:nm,mc:nc};}
  lastGuessed[currentPlayer]=name;currentPlayer=1-currentPlayer;closeModal();updateUI();resetTimer();toggleTimer();
}

function closeModal(){document.getElementById('modal-overlay').classList.remove('open');activeCell=null;}

function renderCell(r,c){
  const cell=document.getElementById(`cell-${r}-${c}`),data=board[r][c];if(!data)return;
  cell.classList.add('claimed');cell.innerHTML='';
  if(data.photo){const img=document.createElement('img');img.className='cell-photo';img.src=data.photo;img.alt=data.name;cell.appendChild(img);const g=document.createElement('div');g.className='cell-gradient';cell.appendChild(g);const n=document.createElement('div');n.className='cell-name';n.textContent=data.name;cell.appendChild(n);}
  else{cell.style.background=`color-mix(in srgb,${players[data.player].color} 30%,var(--cell-bg))`;const n=document.createElement('div');n.className='cell-name-dark';n.style.color=getLabelColor(players[data.player].color);n.textContent=data.name;cell.appendChild(n);}
  const b=document.createElement('div');b.className='cell-border-overlay';b.style.setProperty('--claim-color',players[data.player].color);cell.appendChild(b);
}

function checkMiniTTT(mr,mc){
  const g=Array.from({length:3},(_,i)=>Array.from({length:3},(_,j)=>{const d=board[mr*3+i][mc*3+j];return d?d.player:null;}));
  for(const l of[[[0,0],[0,1],[0,2]],[[1,0],[1,1],[1,2]],[[2,0],[2,1],[2,2]],[[0,0],[1,0],[2,0]],[[0,1],[1,1],[2,1]],[[0,2],[1,2],[2,2]],[[0,0],[1,1],[2,2]],[[0,2],[1,1],[2,0]]]){const v=l.map(([ri,ci])=>g[ri][ci]);if(v[0]!==null&&v[0]===v[1]&&v[1]===v[2])return v[0];}
  return null;
}
function isMiniGridFull(mr,mc){for(let i=0;i<3;i++)for(let j=0;j<3;j++)if(!board[mr*3+i][mc*3+j])return false;return true;}

function renderMiniWon(mr,mc,p){
  const col=players[p].color;
  for(let i=0;i<3;i++)for(let j=0;j<3;j++){
    const cell=document.getElementById(`cell-${mr*3+i}-${mc*3+j}`);
    cell.classList.add('claimed');cell.innerHTML='';cell.style.background=col;
    const n=document.createElement('div');
    const tc=getLabelColor(col);
    n.style.cssText=`position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:11px;letter-spacing:1px;color:${tc};text-shadow:0 1px 3px rgba(0,0,0,0.2);text-align:center;padding:2px;`;
    n.textContent=players[p].name.toUpperCase();cell.appendChild(n);
  }
}

function showWinScreen(p){
  document.getElementById('win-name').textContent=players[p].name.toUpperCase();
  document.getElementById('win-name').style.color=players[p].color;
  document.getElementById('win-screen').classList.add('open');
}

document.getElementById('modal-overlay').addEventListener('click',function(e){if(e.target===this)closeModal();});
</script>
</body>
</html>
