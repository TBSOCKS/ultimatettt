<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBH ‚Äî Ultimate Tic Tac Trivia (Example)</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f0f4f8;
    --surface: #dce8f5;
    --cell-bg: #e8f0f8;
    --border: #a0b8d0;
    --divider: #2a7de1;
    --text: #1a1a2e;
    --muted: #4a6080;
    --accent: #2a7de1;
    --header-bg: #b8d0e8;
    --p1: #e85d5d;
    --p2: #4caf50;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; display: flex; flex-direction: column; height: 100vh; }

  /* ===== BANNER ===== */
  .sandbox-banner {
    background: #fff8e1; border-bottom: 2px solid #f0a500;
    padding: 6px 16px; display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; flex-shrink: 0;
  }
  .sandbox-label { font-family: 'Bebas Neue', sans-serif; font-size: 14px; letter-spacing: 3px; color: #b07800; }
  .sandbox-note { font-size: 11px; color: #a07000; letter-spacing: 0.5px; }
  .banner-btns { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .reset-btn { background: transparent; border: 1px solid #f0a500; color: #b07800; border-radius: 6px; padding: 5px 14px; font-family: 'Bebas Neue', sans-serif; font-size: 13px; letter-spacing: 2px; cursor: pointer; transition: all 0.15s; }
  .reset-btn:hover { background: #f0a500; color: #fff; }
  .nav-link { background: transparent; border: 1px solid var(--border); color: var(--muted); border-radius: 6px; padding: 5px 14px; font-family: 'Bebas Neue', sans-serif; font-size: 13px; letter-spacing: 2px; text-decoration: none; transition: all 0.15s; }
  .nav-link:hover { border-color: var(--accent); color: var(--accent); }

  /* ===== GAME SCREEN ===== */
  #game-screen { display: flex; flex-direction: column; flex: 1; padding: 8px; gap: 8px; overflow: hidden; }
  .game-header { display: flex; align-items: center; justify-content: space-between; background: #fff; border: 1px solid var(--border); border-radius: 10px; padding: 8px 16px; flex-shrink: 0; gap: 8px; flex-wrap: wrap; }
  .player-badge { display: flex; align-items: center; gap: 8px; padding: 6px 14px; border-radius: 6px; border: 2px solid transparent; transition: all 0.25s; }
  .player-badge.active { border-color: var(--player-color, var(--accent)); background: color-mix(in srgb, var(--player-color, var(--accent)) 12%, transparent); }
  .badge-dot { width: 11px; height: 11px; border-radius: 50%; flex-shrink: 0; }
  .badge-name { font-family: 'Bebas Neue', sans-serif; font-size: 18px; letter-spacing: 2px; color: var(--text); }
  .badge-score { font-size: 12px; color: var(--muted); font-weight: 600; }
  .turn-indicator { font-family: 'Bebas Neue', sans-serif; font-size: 12px; letter-spacing: 3px; text-transform: uppercase; color: var(--muted); text-align: center; }
  .turn-name { font-size: 16px; display: block; }
  .header-reset { background: transparent; border: 1px solid #f0a500; color: #b07800; border-radius: 6px; padding: 5px 12px; font-family: 'Bebas Neue', sans-serif; font-size: 12px; letter-spacing: 2px; cursor: pointer; transition: all 0.15s; white-space: nowrap; }
  .header-reset:hover { background: #f0a500; color: #fff; }

  /* ===== MEGA GRID ===== */
  .grid-wrapper { overflow: auto; flex: 1; border: 3px solid var(--divider); border-radius: 4px; background: var(--divider); }
  .mega-grid { display: grid; grid-template-columns: 120px repeat(3,1fr) 3px repeat(3,1fr) 3px repeat(3,1fr); grid-template-rows: auto repeat(3,75px) 3px repeat(3,75px) 3px repeat(3,75px); width: 100%; min-width: 820px; gap: 0; }
  .corner-cell { background: var(--header-bg); border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 21; }
  .macro-divider-col { background: var(--divider); grid-row: 1/-1; }
  .macro-divider-row { background: var(--divider); grid-column: 1/-1; }
  .col-header { background: var(--header-bg); border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 5px 4px; font-size: 9px; font-weight: 700; text-align: center; color: var(--text); line-height: 1.25; display: flex; align-items: center; justify-content: center; text-transform: uppercase; letter-spacing: 0.2px; position: sticky; top: 0; z-index: 20; }
  .row-header { background: var(--header-bg); border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 5px 7px; font-size: 9px; font-weight: 700; color: var(--text); line-height: 1.25; display: flex; align-items: center; text-transform: uppercase; letter-spacing: 0.2px; justify-content: center; text-align: center; }
  .grid-cell { background: var(--cell-bg); border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); cursor: pointer; position: relative; overflow: hidden; transition: background 0.1s; }
  .grid-cell:hover:not(.claimed):not(.locked) { background: #ccdff5; z-index: 5; }
  .grid-cell.selectable { animation: pulse 1.6s ease-in-out infinite; }
  @keyframes pulse { 0%,100% { box-shadow: inset 0 0 0 2px rgba(42,125,225,0.35); } 50% { box-shadow: inset 0 0 0 3px rgba(42,125,225,0.8); } }
  .grid-cell.locked { cursor: not-allowed; opacity: 0.38; }
  .grid-cell.claimed { cursor: default; }
  .cell-photo { width: 100%; height: 100%; object-fit: cover; position: absolute; inset: 0; }
  .cell-gradient { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 55%); pointer-events: none; }
  .cell-name { position: absolute; bottom: 3px; left: 0; right: 0; text-align: center; font-size: 8px; font-weight: 700; color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.9); pointer-events: none; }
  .cell-name-dark { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; color: var(--text); pointer-events: none; text-align: center; padding: 2px; }
  .cell-border-overlay { position: absolute; inset: 0; border: 4px solid var(--claim-color, transparent); pointer-events: none; z-index: 2; }
  .mini-won-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 10; display: flex; align-items: center; justify-content: center; font-family: 'Bebas Neue', sans-serif; letter-spacing: 1px; }

  /* ===== MODAL ===== */
  #modal-overlay { display: none; position: fixed; inset: 0; background: rgba(10,20,40,0.55); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
  #modal-overlay.open { display: flex; }
  .modal { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 24px; width: 92%; max-width: 460px; display: flex; flex-direction: column; gap: 15px; animation: modal-in 0.2s ease; max-height: 90vh; overflow-y: auto; box-shadow: 0 8px 40px rgba(42,125,225,0.18); }
  @keyframes modal-in { from { transform: translateY(12px) scale(0.97); opacity: 0; } to { transform: none; opacity: 1; } }
  .modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 13px; letter-spacing: 3px; color: var(--muted); text-transform: uppercase; }
  .modal-cats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .modal-cat { background: #eaf2ff; border: 1px solid #c0d8f0; border-radius: 8px; padding: 9px 11px; font-size: 10px; font-weight: 700; color: var(--text); line-height: 1.4; }
  .modal-cat span { display: block; font-size: 8px; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); margin-bottom: 2px; }
  .modal-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 5px; }
  .answer-select { width: 100%; background: #f4f8fc; border: 1px solid var(--border); border-radius: 8px; padding: 11px 13px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%234a6080' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 13px center; padding-right: 34px; }
  .answer-select:focus { outline: none; border-color: var(--accent); }
  .answer-select option { background: #fff; color: var(--text); }
  .cast-roster { display: flex; flex-wrap: wrap; gap: 5px; }
  .cast-tag { padding: 4px 9px; border-radius: 20px; font-size: 10px; font-weight: 600; background: #eaf2ff; border: 1px solid #c0d8f0; color: var(--text); white-space: nowrap; }
  .cast-tag.strikeout { text-decoration: line-through; opacity: 0.38; color: var(--muted); }
  .modal-btns { display: flex; flex-direction: column; gap: 8px; }
  .btn-submit { background: var(--accent); color: #fff; border: none; border-radius: 8px; padding: 13px; font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 2px; cursor: pointer; transition: background 0.15s; }
  .btn-submit:hover { background: #1a6dd1; }
  .btn-cancel { background: transparent; color: var(--muted); border: 1px solid var(--border); border-radius: 8px; padding: 9px; font-family: 'DM Sans', sans-serif; font-size: 13px; cursor: pointer; }
  .btn-cancel:hover { border-color: var(--accent); color: var(--accent); }
  .modal-correct { text-align: center; font-family: 'Bebas Neue', sans-serif; font-size: 56px; letter-spacing: 4px; padding: 24px 0; animation: correct-pop 0.35s ease; }
  @keyframes correct-pop { 0% { transform: scale(0.6); opacity: 0; } 70% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }

  /* ===== WIN ===== */
  #win-screen { display: none; position: fixed; inset: 0; background: rgba(240,244,248,0.96); z-index: 200; align-items: center; justify-content: center; flex-direction: column; gap: 16px; text-align: center; }
  #win-screen.open { display: flex; }
  .win-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(60px,12vw,120px); letter-spacing: 8px; line-height: 1; }
  .win-sub { font-size: 14px; color: var(--muted); letter-spacing: 3px; text-transform: uppercase; }
  .win-btns { display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; justify-content: center; }
  .win-again { background: var(--accent); color: #fff; border: none; border-radius: 10px; padding: 14px 36px; font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 3px; cursor: pointer; }
  .win-again:hover { background: #1a6dd1; }
  .win-reset { background: transparent; border: 1px solid #f0a500; color: #b07800; border-radius: 10px; padding: 14px 36px; font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 3px; cursor: pointer; }
  .win-reset:hover { background: #f0a500; color: #fff; }

  /* ===== CONFIRM ===== */
  #confirm-overlay { display: none; position: fixed; inset: 0; background: rgba(10,20,40,0.5); z-index: 300; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
  #confirm-overlay.open { display: flex; }
  .confirm-box { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 28px; max-width: 340px; width: 90%; text-align: center; display: flex; flex-direction: column; gap: 16px; animation: modal-in 0.2s ease; }
  .confirm-title { font-family: 'Bebas Neue', sans-serif; font-size: 26px; letter-spacing: 3px; color: #b07800; }
  .confirm-sub { font-size: 13px; color: var(--muted); line-height: 1.5; }
  .confirm-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .confirm-yes { background: #c0392b; color: #fff; border: none; border-radius: 8px; padding: 11px; font-family: 'Bebas Neue', sans-serif; font-size: 17px; letter-spacing: 2px; cursor: pointer; }
  .confirm-yes:hover { background: #a93226; }
  .confirm-no { background: transparent; color: var(--muted); border: 1px solid var(--border); border-radius: 8px; padding: 11px; font-family: 'Bebas Neue', sans-serif; font-size: 17px; letter-spacing: 2px; cursor: pointer; }
  .confirm-no:hover { border-color: var(--accent); color: var(--accent); }
</style>
</head>
<body>

<!-- Banner -->
<div class="sandbox-banner">
  <div>
    <div class="sandbox-label">‚≠ê Example Page</div>
    <div class="sandbox-note">Demo game ‚Äî not the live competition</div>
  </div>
  <div class="banner-btns">
    <button class="reset-btn" onclick="confirmReset()">‚Ü∫ RESET</button>
    <a href="/index.html" class="nav-link">‚Üê MAIN GAME</a>
    <a href="/test.html" class="nav-link">SANDBOX ‚Üí</a>
  </div>
</div>

<!-- Game -->
<div id="game-screen">
  <div class="game-header">
    <div class="player-badge" id="badge-p1">
      <div class="badge-dot" id="dot-p1"></div>
      <div class="badge-name" id="name-p1">Blake</div>
      <div class="badge-score">üèÜ <span id="score-p1">0</span> / 3</div>
    </div>
    <div style="text-align:center;display:flex;flex-direction:column;align-items:center;gap:6px;">
      <div class="turn-indicator">Current Turn<span class="turn-name" id="turn-display">‚Äî</span></div>
      <button class="header-reset" onclick="confirmReset()">‚Ü∫ RESET</button>
    </div>
    <div class="player-badge" id="badge-p2">
      <div class="badge-dot" id="dot-p2"></div>
      <div class="badge-name" id="name-p2">Blake's Worst Enemy</div>
      <div class="badge-score">üèÜ <span id="score-p2">0</span> / 3</div>
    </div>
  </div>
  <div class="grid-wrapper">
    <div class="mega-grid" id="mega-grid"></div>
  </div>
</div>

<!-- Modal -->
<div id="modal-overlay">
  <div class="modal">
    <div id="modal-inner"></div>
  </div>
</div>

<!-- Win -->
<div id="win-screen">
  <div class="win-title" id="win-name"></div>
  <div class="win-sub">Wins Ultimate Tic Tac Trivia!</div>
  <div class="win-btns">
    <button class="win-again" onclick="restartSame()">PLAY AGAIN</button>
    <button class="win-reset" onclick="confirmReset()">‚Ü∫ RESET</button>
  </div>
</div>

<!-- Confirm Reset -->
<div id="confirm-overlay">
  <div class="confirm-box">
    <div class="confirm-title">Reset Game?</div>
    <div class="confirm-sub">This will clear the board and start fresh.</div>
    <div class="confirm-btns">
      <button class="confirm-yes" onclick="doReset()">YES, RESET</button>
      <button class="confirm-no" onclick="closeConfirm()">CANCEL</button>
    </div>
  </div>
</div>

<script>
// ============================================================
// DATA
// ============================================================
const ALL_CAST = ["Ashley","Blake","CLC","Dan","Focer","Josh","Kadri","Lee","Max","Mitchell","Ric","Sterling"];

const CAST_PHOTOS = {
  "Ashley":"","Blake":"","CLC":"","Dan":"","Focer":"","Josh":"",
  "Kadri":"","Lee":"","Max":"","Mitchell":"","Ric":"","Sterling":""
};

const COL_CATS = [
  "WEARS GLASSES",
  "HAS A FAT JUICY ASS",
  "HETERO",
  "WOMAN",
  "WON BBH15",
  "PARENT",
  "BOUGHT SOLO CUPS AT THE CHOR BAZAAR",
  "LOVES THE BOARD GAME AZUL",
  "OWNS SHREK 2 ON BLU-RAY"
];

const ROW_CATS = [
  "PLAYED BBH14",
  "MAN",
  "FIST-FOUGHT MY UNCLE IN 2005",
  "FAVORITE ANIMAL IS PARAKEET",
  "HAD AN INCIDENT WITH FROSTED MINI WHEATS",
  "HELD A PLASTIC KNIFE TO SOMEONE'S THROAT AT AN LRG",
  "VOICE ACTED IN MADAGASCAR (THE MOVIE NOT THE COUNTRY)",
  "HAS NEVER WON AN ORG",
  "HAS A FART FETISH ACCOUNT"
];

// Only the specified cells have real answers; all others are empty arrays
// (host can still accept any answer ‚Äî empty means no auto-validation, treat all as correct)
// Specified: HAS A FAT JUICY ASS / PLAYED BBH14 = Ric  [row=0, col=1]
//            WON BBH15 / MAN = Blake                   [row=1, col=4]
//            PARENT / HELD A PLASTIC KNIFE...           [row=5, col=5]
const VALID_ANSWERS = [
  // row 0: PLAYED BBH14
  [[], ["RIC"], [], [], [], [], [], [], []],
  // row 1: MAN
  [[], [], [], [], ["BLAKE"], [], [], [], []],
  // row 2: FIST-FOUGHT MY UNCLE IN 2005
  [[], [], [], [], [], [], [], [], []],
  // row 3: FAVORITE ANIMAL IS PARAKEET
  [[], [], [], [], [], [], [], [], []],
  // row 4: HAD AN INCIDENT WITH FROSTED MINI WHEATS
  [[], [], [], [], [], [], [], [], []],
  // row 5: HELD A PLASTIC KNIFE TO SOMEONE'S THROAT AT AN LRG
  [[], [], [], [], [], ["STERLING"], [], [], []],
  // row 6: VOICE ACTED IN MADAGASCAR
  [[], [], [], [], [], [], [], [], []],
  // row 7: HAS NEVER WON AN ORG
  [[], [], [], [], [], [], [], [], []],
  // row 8: HAS A FART FETISH ACCOUNT
  [[], [], [], [], [], [], [], [], []]
];

// ============================================================
// PLAYERS (no setup screen ‚Äî pre-defined)
// ============================================================
const players = [
  { name: "Blake", color: "#e85d5d" },
  { name: "Blake's Worst Enemy", color: "#4caf50" }
];

let board, miniWon, currentPlayer, scores, forcedMacro, activeCell, wrongGuesses;

function initState() {
  board = Array.from({length:9},()=>Array(9).fill(null));
  miniWon = Array.from({length:3},()=>Array(3).fill(null));
  currentPlayer=0; scores=[0,0]; forcedMacro=null; activeCell=null;
  wrongGuesses = Array.from({length:9},()=>Array.from({length:9},()=>new Set()));
}

// ============================================================
// INIT ON LOAD
// ============================================================
window.addEventListener('DOMContentLoaded', () => {
  document.getElementById('dot-p1').style.background = players[0].color;
  document.getElementById('dot-p2').style.background = players[1].color;
  document.getElementById('badge-p1').style.setProperty('--player-color', players[0].color);
  document.getElementById('badge-p2').style.setProperty('--player-color', players[1].color);
  initState();
  buildGrid();
  updateUI();
});

// ============================================================
// RESET
// ============================================================
function confirmReset() { document.getElementById('confirm-overlay').classList.add('open'); }
function closeConfirm() { document.getElementById('confirm-overlay').classList.remove('open'); }
function doReset() {
  closeConfirm();
  document.getElementById('win-screen').classList.remove('open');
  document.getElementById('modal-overlay').classList.remove('open');
  document.getElementById('mega-grid').innerHTML='';
  initState(); buildGrid(); updateUI();
}
function restartSame() {
  document.getElementById('win-screen').classList.remove('open');
  document.getElementById('mega-grid').innerHTML='';
  initState(); buildGrid(); updateUI();
}

// ============================================================
// GRID
// ============================================================
function gcol(c){return 2+c+Math.floor(c/3);}
function grow(r){return 2+r+Math.floor(r/3);}

function buildGrid() {
  const g=document.getElementById('mega-grid'); g.innerHTML='';
  const co=document.createElement('div'); co.className='corner-cell'; co.style.cssText='grid-column:1;grid-row:1;'; g.appendChild(co);
  [5,9].forEach(gc=>{const d=document.createElement('div');d.className='macro-divider-col';d.style.cssText=`grid-column:${gc};grid-row:1/-1;`;g.appendChild(d);});
  [5,9].forEach(gr=>{const d=document.createElement('div');d.className='macro-divider-row';d.style.cssText=`grid-row:${gr};grid-column:1/-1;`;g.appendChild(d);});
  for(let c=0;c<9;c++){const h=document.createElement('div');h.className='col-header';h.style.cssText=`grid-column:${gcol(c)};grid-row:1;`;h.textContent=COL_CATS[c];g.appendChild(h);}
  for(let r=0;r<9;r++){
    const gr2=grow(r);
    const rh=document.createElement('div');rh.className='row-header';rh.style.cssText=`grid-column:1;grid-row:${gr2};`;rh.textContent=ROW_CATS[r];g.appendChild(rh);
    for(let c=0;c<9;c++){
      const cell=document.createElement('div');cell.className='grid-cell';cell.id=`cell-${r}-${c}`;
      cell.style.cssText=`grid-column:${gcol(c)};grid-row:${gr2};`;
      cell.addEventListener('click',()=>onCellClick(r,c));g.appendChild(cell);
    }
  }
}

// ============================================================
// UI
// ============================================================
function updateUI() {
  const td=document.getElementById('turn-display');
  td.textContent=players[currentPlayer].name;
  td.style.color=players[currentPlayer].color;
  document.getElementById('badge-p1').classList.toggle('active',currentPlayer===0);
  document.getElementById('badge-p2').classList.toggle('active',currentPlayer===1);
  document.getElementById('score-p1').textContent=scores[0];
  document.getElementById('score-p2').textContent=scores[1];
  for(let r=0;r<9;r++) for(let c=0;c<9;c++){
    const cell=document.getElementById(`cell-${r}-${c}`);
    cell.classList.remove('selectable','locked');
    const mr=Math.floor(r/3),mc=Math.floor(c/3);
    if(!board[r][c]){
      if(miniWon[mr][mc]!==null) cell.classList.add('locked');
      else if(forcedMacro===null) cell.classList.add('selectable');
      else if(mr===forcedMacro.mr&&mc===forcedMacro.mc) cell.classList.add('selectable');
      else cell.classList.add('locked');
    }
  }
}

// ============================================================
// CELL CLICK
// ============================================================
function onCellClick(r,c) {
  if(!document.getElementById(`cell-${r}-${c}`).classList.contains('selectable')) return;
  activeCell={r,c};
  document.getElementById('modal-inner').innerHTML=`
    <div class="modal-title">Make Your Guess</div>
    <div class="modal-cats">
      <div class="modal-cat"><span>Column</span>${COL_CATS[c]}</div>
      <div class="modal-cat"><span>Row</span>${ROW_CATS[r]}</div>
    </div>
    <div><div class="modal-label">Cast Members</div><div class="cast-roster" id="cast-roster"></div></div>
    <div><div class="modal-label">Select a Cast Member</div><select class="answer-select" id="answer-select"><option value="">‚Äî choose ‚Äî</option></select></div>
    <div class="modal-btns">
      <button class="btn-submit" onclick="submitAnswer()">SUBMIT ANSWER</button>
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
    </div>
  `;
  refreshCastList(r,c);
  document.getElementById('modal-overlay').classList.add('open');
}

function refreshCastList(r,c) {
  const mr=Math.floor(r/3),mc=Math.floor(c/3),used={};
  for(let i=0;i<3;i++) for(let j=0;j<3;j++){const d=board[mr*3+i][mc*3+j];if(d)used[d.name]=(used[d.name]||0)+1;}
  const roster=document.getElementById('cast-roster'),sel=document.getElementById('answer-select');
  if(!roster||!sel) return;
  roster.innerHTML=''; sel.innerHTML='<option value="">‚Äî choose ‚Äî</option>';
  ALL_CAST.forEach(n=>{
    const struck=wrongGuesses[r][c].has(n)||(used[n]||0)>=2;
    const t=document.createElement('div');t.className='cast-tag'+(struck?' strikeout':'');t.textContent=n;roster.appendChild(t);
    if(!struck){const o=document.createElement('option');o.value=n;o.textContent=n;sel.appendChild(o);}
  });
}

// ============================================================
// SUBMIT ‚Äî cells with empty VALID_ANSWERS arrays auto-accept any answer
// ============================================================
function submitAnswer() {
  if(!activeCell) return;
  const{r,c}=activeCell,sel=document.getElementById('answer-select'),name=sel?sel.value:'';
  if(!name) return;
  const validList=VALID_ANSWERS[r][c];
  const isCorrect = validList.length===0 || validList.includes(name.toUpperCase());
  if(isCorrect){
    document.getElementById('modal-inner').innerHTML=`<div class="modal-correct" style="color:${players[currentPlayer].color}">CORRECT!</div>`;
    setTimeout(()=>commitCorrect(r,c,name),900);
  } else {
    wrongGuesses[r][c].add(name);
    document.getElementById('modal-inner').innerHTML=`<div class="modal-correct" style="color:#e85d5d">INCORRECT!</div>`;
    setTimeout(()=>{ forcedMacro=null; currentPlayer=1-currentPlayer; closeModal(); updateUI(); },900);
  }
}

function commitCorrect(r,c,name) {
  board[r][c]={player:currentPlayer,name,photo:CAST_PHOTOS[name]||''};
  renderCell(r,c);
  const mr=Math.floor(r/3),mc=Math.floor(c/3),res=checkMiniTTT(mr,mc);
  let won=false;
  if(res!==null&&miniWon[mr][mc]===null){
    miniWon[mr][mc]=res;scores[res]++;renderMiniWon(mr,mc,res);won=true;
    if(scores[0]>=3||scores[1]>=3){closeModal();showWinScreen(res);return;}
  }
  const nm=r%3,nc=c%3;
  forcedMacro=won?null:(miniWon[nm][nc]!==null||isMiniGridFull(nm,nc))?null:{mr:nm,mc:nc};
  currentPlayer=1-currentPlayer;closeModal();updateUI();
}

function closeModal(){document.getElementById('modal-overlay').classList.remove('open');activeCell=null;}

function renderCell(r,c){
  const cell=document.getElementById(`cell-${r}-${c}`),data=board[r][c];if(!data)return;
  cell.classList.add('claimed');cell.innerHTML='';
  if(data.photo){
    const img=document.createElement('img');img.className='cell-photo';img.src=data.photo;img.alt=data.name;cell.appendChild(img);
    const g=document.createElement('div');g.className='cell-gradient';cell.appendChild(g);
    const n=document.createElement('div');n.className='cell-name';n.textContent=data.name;cell.appendChild(n);
  } else {
    cell.style.background=`color-mix(in srgb,${players[data.player].color} 30%,var(--cell-bg))`;
    const n=document.createElement('div');n.className='cell-name-dark';n.textContent=data.name;cell.appendChild(n);
  }
  const b=document.createElement('div');b.className='cell-border-overlay';b.style.setProperty('--claim-color',players[data.player].color);cell.appendChild(b);
}

function checkMiniTTT(mr,mc){
  const g=Array.from({length:3},(_,i)=>Array.from({length:3},(_,j)=>{const d=board[mr*3+i][mc*3+j];return d?d.player:null;}));
  for(const l of[[[0,0],[0,1],[0,2]],[[1,0],[1,1],[1,2]],[[2,0],[2,1],[2,2]],[[0,0],[1,0],[2,0]],[[0,1],[1,1],[2,1]],[[0,2],[1,2],[2,2]],[[0,0],[1,1],[2,2]],[[0,2],[1,1],[2,0]]]){
    const v=l.map(([ri,ci])=>g[ri][ci]);if(v[0]!==null&&v[0]===v[1]&&v[1]===v[2])return v[0];
  }
  return null;
}
function isMiniGridFull(mr,mc){for(let i=0;i<3;i++)for(let j=0;j<3;j++)if(!board[mr*3+i][mc*3+j])return false;return true;}

function renderMiniWon(mr,mc,p){
  const col=players[p].color;
  for(let i=0;i<3;i++)for(let j=0;j<3;j++){
    const cell=document.getElementById(`cell-${mr*3+i}-${mc*3+j}`);
    cell.style.background=`color-mix(in srgb,${col} 30%,var(--cell-bg))`;
    const ov=document.createElement('div');ov.className='mini-won-overlay';
    ov.style.cssText=`background:color-mix(in srgb,${col} 18%,transparent);border:3px solid ${col};`;
    if(i===1&&j===1){ov.style.color=col;ov.style.fontFamily="'Bebas Neue',sans-serif";ov.style.fontSize='13px';ov.textContent=players[p].name.substring(0,5).toUpperCase();}
    cell.appendChild(ov);
  }
}

function showWinScreen(p){
  document.getElementById('win-name').textContent=players[p].name.toUpperCase();
  document.getElementById('win-name').style.color=players[p].color;
  document.getElementById('win-screen').classList.add('open');
}

document.getElementById('modal-overlay').addEventListener('click',function(e){if(e.target===this)closeModal();});
</script>
</body>
</html>
